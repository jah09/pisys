name: Auto PR to Dev

on:
  push:
    branches:
      - "**"

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-pr:
    # Skip if branch is main or dev
    if: github.ref_name != 'main' && github.ref_name != 'dev'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create or Update Pull Request to Dev
        run: |
          BRANCH="${{ github.ref_name }}"
          COMMIT_MSG=$(git log -1 --pretty=%B)

          echo "üîç Checking for existing PR from branch: $BRANCH ‚Üí dev"

          EXISTING_PR=$(gh pr list \
            --base dev \
            --head "$BRANCH" \
            --json number --jq '.[0].number' || true)

          if [ -n "$EXISTING_PR" ]; then
            echo "‚úÖ PR #$EXISTING_PR already exists for branch $BRANCH. Updating..."
            gh pr edit "$EXISTING_PR" \
              --title "$COMMIT_MSG" \
              --body "This PR was automatically updated by GitHub Actions."
          else
            echo "üöÄ Creating a new PR for branch $BRANCH ‚Üí dev"
            gh pr create \
              --base dev \
              --head "$BRANCH" \
              --title "$COMMIT_MSG" \
              --body "This pull request was automatically created by GitHub Actions."
          fi
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
